---
title: LogicFlowè‡ªå®šä¹‰è¾¹ï¼ˆEdgeï¼‰
date: '2023-01-02 21:06'
sidebar: 'auto'
categories:
 - LogicFlow
tags:
 - LogicFlow
---

:::tip
LogicFlow æ˜¯ä¸€æ¬¾æµç¨‹å›¾ç¼–è¾‘æ¡†æ¶ï¼Œæä¾›äº†ä¸€ç³»åˆ—æµç¨‹å›¾äº¤äº’ã€ç¼–è¾‘æ‰€å¿…éœ€çš„åŠŸèƒ½å’Œçµæ´»çš„èŠ‚ç‚¹è‡ªå®šä¹‰ã€æ’ä»¶ç­‰æ‹“å±•æœºåˆ¶ã€‚LogicFlowæ”¯æŒå‰ç«¯ç ”å‘è‡ªå®šä¹‰å¼€å‘å„ç§é€»è¾‘ç¼–æ’åœºæ™¯ï¼Œå¦‚æµç¨‹å›¾ã€ERå›¾ã€BPMNæµç¨‹ç­‰ã€‚åœ¨å·¥ä½œå®¡æ‰¹é…ç½®ã€æœºå™¨äººé€»è¾‘ç¼–æ’ã€æ— ä»£ç å¹³å°æµç¨‹é…ç½®éƒ½æœ‰è¾ƒå¥½çš„åº”ç”¨ã€‚
:::

<!-- more -->

> ğŸ„Hi~ å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å°é‘«åŒå­¦ï¼Œä¸€ä½é•¿æœŸä»äº‹å‰ç«¯å¼€å‘çš„ç¼–ç¨‹çˆ±å¥½è€…ï¼Œæˆ‘å°†ä½¿ç”¨æ›´ä¸ºå®ç”¨çš„æ¡ˆä¾‹è¾“å‡ºæ›´å¤šçš„ç¼–ç¨‹çŸ¥è¯†ï¼ŒåŒæ—¶æˆ‘ä¿¡å¥‰åˆ†äº«æ˜¯æˆé•¿çš„å”¯ä¸€æ·å¾„ï¼Œåœ¨è¿™é‡Œä¹Ÿå¸Œæœ›æˆ‘çš„æ¯ä¸€ç¯‡æ–‡ç« éƒ½èƒ½æˆä¸ºä½ æŠ€æœ¯è½åœ°çš„å‚è€ƒ~

### 1. å‡†å¤‡å·¥ä½œï¼š
[LogicFlowå‡†å¤‡å·¥ä½œ](https://www.yuque.com/fe-xiaoxin/zyv484/xsc5l5ifqi2slekv?view=doc_embed)
### 2. è‡ªå®šä¹‰è¾¹ï¼ˆEdgeï¼‰ï¼š
#### 2.1 å‡†å¤‡è‡ªå®šä¹‰æ¨¡æ¿ï¼š
> å‡†å¤‡è‡ªå®šä¹‰è¾¹ï¼ˆEdgeï¼‰æ¨¡æ¿ï¼Œåˆ†åˆ«ç»§æ‰¿`PolygonNode`å’Œ`PolylineEdgeModel`å¹¶å¯¼å‡º`type`ã€`view`å’Œ`model`ä¸‰ä¸ªé€‰é¡¹ï¼š

```typescript
import { PolylineEdge, PolylineEdgeModel } from "@logicflow/core";

class CustomEdgeNode extends PolylineEdge {
	// å®˜ç½‘æŒ‡ç¤ºï¼šç”±äºè¾¹çš„ç¼–è¾‘å¤æ‚åº¦é—®é¢˜ï¼Œç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè‡ªå®šä¹‰è¾¹æ—¶ä¸æ¨èè‡ªå®šä¹‰view
}

class CustomEdgeModel extends PolylineEdgeModel {

}

export default {
    type: "CustomEdge",
    view: CustomEdgeNode,
    model: CustomEdgeModel,
}
```
#### 2.2 ä¼˜å…ˆæ³¨å†Œ&ä½¿ç”¨ï¼š
> ä¼˜å…ˆè¿›è¡Œæ³¨å†Œå¹¶å®šä¹‰æ•°æ®ï¼Œæ–¹ä¾¿è‡ªå®šä¹‰è¾¹ï¼ˆEdgeï¼‰å®æ—¶é¢„è§ˆï¼›

```typescript
<script setup lang="ts">
// å¯¼å…¥è‡ªå®šä¹‰èŠ‚ç‚¹
import CustomEdge from "./edges/CustomEdge";

// å‡†å¤‡ä¸¤ä¸ªNodeï¼Œå¹¶ä½¿ç”¨è‡ªå®šä¹‰Edgeæ¥è¿æ¥å®ƒä»¬ä¿©
const graphData = {
  nodes: [
    {
      id: '242b1b6c-1721-4b10-b4ad-c895094cf332',
      type: 'rect',
      x: 100,
      y: 100
    },
    {
      id: 'e59d6ecd-68f7-4d50-8e3f-29e67b6e5f16',
      type: 'circle',
      x: 300,
      y: 200
    }
  ],
  edges: [
    {
      sourceNodeId: '242b1b6c-1721-4b10-b4ad-c895094cf332',
      targetNodeId: 'e59d6ecd-68f7-4d50-8e3f-29e67b6e5f16',
      type: 'CustomEdge',
    }
  ]
}

onMounted(() => {
  // åœ¨æ‰§è¡Œrenderå‰è¿›è¡Œæ³¨å†Œ
  lf.value.register(CustomEdge);
  lf.value.render(graphData);
})
</script>
```
#### 2.3 è‡ªå®šä¹‰Edge&Text&Outlineçš„é£æ ¼ï¼š
> å¯¹äº`Edge`é£æ ¼çš„è‡ªå®šä¹‰å¯ä»¥é€šè¿‡é‡å†™ä¸åŒçš„å‡½æ•°æ¥å®ç°ï¼Œå¦‚é‡å†™ï¼š`getEdgeStyle()`ã€`getTextStyle()`å’Œ`getOutlineStyle()`ï¼Œè¿˜æœ‰æœ€åå¯¹ç®­å¤´é£æ ¼çš„è‡ªå®šä¹‰ï¼›

```typescript
class CustomEdgeModel extends PolylineEdgeModel {
    getEdgeStyle() {
        const style = super.getEdgeStyle();
        const { properties } = this;
        if (properties.isActived) {
            style.strokeDasharray = "4 4";
        }
        style.stroke = "orange";
        return style;
    }
    getTextStyle() {
        const style = super.getTextStyle();
        style.color = "#3451F1";
        style.fontSize = 20;
        style.background && (style.background.fill = "#F2F131");
        return style;
    }
    getOutlineStyle() {
        const style = super.getOutlineStyle();
        style.stroke = "red";
        style.hover && (style.hover.stroke = "red");
        return style;
    }
}
```
#### 2.4 ä¿å­˜é”šç‚¹ä¿¡æ¯ï¼š
> é»˜è®¤æƒ…å†µä¸‹LFåªè®°å½•Nodeä¹‹é—´çš„ä¿¡æ¯ï¼Œä½†æ˜¯å¦‚æœé‡åˆ°ä¸åŒçš„é”šç‚¹ä»£è¡¨ä¸åŒå«ä¹‰çš„ä¸šåŠ¡åœºæ™¯æ—¶ï¼Œå°±å¯ä»¥é€šè¿‡é‡å†™getData()å‡½æ•°æ¥æ”¯æŒè®°å½•å¯¹åº”é”šç‚¹çš„IDï¼›

```typescript
// å®šä¹‰ç±»å‹ï¼šæ”¯æŒæºé”šç‚¹å’Œç›®æ ‡é”šç‚¹IDçš„è®°å½•å±æ€§
type ExtendEdgeData = {
    sourceAnchorId: string;
    targetAnchorId: string
} & EdgeData & { pointsList: { x: any; y: any; }[]; }

class CustomEdgeModel extends PolylineEdgeModel {
    getData(): ExtendEdgeData {
        const data = super.getData() as ExtendEdgeData;
        data.sourceAnchorId = this.sourceAnchorId;
        data.targetAnchorId = this.targetAnchorId;
        return data;
    }
}
```
#### 2.5 å¼€å¯è¾¹ï¼ˆEdgeï¼‰åŠ¨ç”»ï¼š
> ä¸ºäº†è¡¨ç¤ºNodeä¹‹é—´æµåŠ¨çš„æ•ˆæœï¼Œå¯ä»¥é€šè¿‡`lf.openEdgeAnimation(edgeId)`å¯åŠ¨é»˜è®¤åŠ¨ç”»ï¼Œä¹Ÿå¯ä»¥é€šè¿‡é‡å†™`getEdgeAnimationStyle()`å‡½æ•°æ¥è‡ªå®šä¹‰åŠ¨ç”»çš„å±æ€§ï¼›

1. å¼€å¯é»˜è®¤åŠ¨ç”»ï¼šä¸ºéœ€è¦å¼€å¯åŠ¨ç”»çš„`Edge`å¢åŠ `id`å­—æ®µï¼Œå¹¶åœ¨æ‰§è¡Œæ¸²æŸ“å‡½æ•°`render()`åå¼€å¯åŠ¨ç”»ï¼š
```typescript
<script setup lang="ts">
const graphData = {
  edges: [
    {
      id: '702a4d2f-b516-4769-adb0-5a4f4f5c07a9',
      sourceNodeId: '242b1b6c-1721-4b10-b4ad-c895094cf332',
      targetNodeId: 'e59d6ecd-68f7-4d50-8e3f-29e67b6e5f16',
      type: 'CustomEdge',
    }
  ]
}

onMounted(() => {
  lf.value.render(graphData);
  // æ‰§è¡Œæ¸²æŸ“åå¼€å¯åŠ¨ç”»
  lf.value.openEdgeAnimation("702a4d2f-b516-4769-adb0-5a4f4f5c07a9");
})
</script>
```

2. è‡ªå®šä¹‰åŠ¨ç”»å±æ€§ï¼šé‡å†™`getEdgeAnimationStyle()`å‡½æ•°è®¾ç½®åŠ¨ç”»å±æ€§ï¼Œé‡å†™`setAttributes()`å‡½æ•°å¼€å¯åŠ¨ç”»ï¼š
```typescript
class CustomEdgeModel extends PolylineEdgeModel {

  	setAttributes(): void {
        this.isAnimation = true;
    }
    
    getEdgeAnimationStyle() {
        const style = super.getEdgeAnimationStyle();
        style.strokeDasharray = "5 5";
        style.animationDuration = "10s";
        return style;
    }
}
```
#### 2.6 è‡ªå®šä¹‰èŠ‚ç‚¹é—´è¾¹ï¼ˆEdgeï¼‰çš„ç±»å‹ï¼š
> é»˜è®¤èŠ‚ç‚¹é—´è¾¹çš„ç±»å‹å¯ä»¥åœ¨å®ä¾‹åŒ–LFæ—¶é€šè¿‡`edgeType`é€‰é¡¹è¿›è¡Œè°ƒæ•´ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨`lf.setDefaultEdgeType(edgeType)`å‡½æ•°æ¥æŒ‡å®šï¼›é™¤æ­¤ä¹‹å¤–ï¼Œä¸ºäº†æ»¡è¶³ä¸åŒçš„ä¸šåŠ¡èŠ‚ç‚¹ä½¿ç”¨ä¸åŒç±»å‹çš„è¾¹æ¥è¡¨ç¤ºè¿˜å¯ä»¥é€šè¿‡å®ä¾‹åŒ–LFæ—¶é€šè¿‡è®¾ç½®`edgeGenerator`å‡½æ•°è¿›è¡Œæ˜¾ç¤ºè§„åˆ™çš„å®šä¹‰ï¼›

1. é€šè¿‡å‡½æ•°è®¾ç½®é»˜è®¤ç±»å‹ï¼š
```typescript
<script setup lang="ts">
onMounted(() => {
  lf.value.setDefaultEdgeType("CustomEdge");
})
</script>
```

2. é€šè¿‡é€‰é¡¹è®¾ç½®é»˜è®¤ç±»å‹ï¼š
```typescript
<script setup lang="ts">
onMounted(() => {
  lf.value = new LogicFlow({
    edgeType: "CustomEdge",
  })
})
</script>
```

3. ä¸ºä¸åŒèŠ‚ç‚¹è®¾ç½®ä¸åŒçš„ç±»å‹ï¼š
```typescript
<script setup lang="ts">
onMounted(() => {
  lf.value = new LogicFlow({
    edgeGenerator(sourceNode, targetNode, currentEdge?) {
      if (sourceNode.type === 'rect') return 'CustomEdge'
    },
  })
})
</script>
```
#### 2.7 è‡ªå®šä¹‰ç®­å¤´çš„ç±»å‹ï¼š
> é€šè¿‡`setTheme()`å‡½æ•°ä¸­æä¾›çš„`arrow`é€‰é¡¹ï¼Œå¯ä»¥æŒ‡å®šé»˜è®¤`Edge`ç®­å¤´çš„é£æ ¼ï¼›ä¹Ÿå¯ä»¥åœ¨ç»§æ‰¿`PolylineEdge`åé€šè¿‡é‡å†™`getEndArrow()`å‡½æ•°æ¥å®ç°æ›´å¤šæ˜¾ç¤ºé£æ ¼çš„

```typescript
<script setup lang="ts">

onMounted(() => {
  lf.value.setTheme({
    arrow: {
      offset: 4, // ç®­å¤´å‚çº¿é•¿åº¦
      verticalLength: 2, // ç®­å¤´åº•çº¿é•¿åº¦
    }
  })
})
</script>
```
é€šè¿‡é¢„ç•™çš„ä¸šåŠ¡æ‰©å±•å±æ€§æ¥åŒºåˆ†ä¸åŒçš„ç®­å¤´é£æ ¼ï¼š
```typescript
class CustomEdgeNode extends PolylineEdge {
    getEndArrow() {
        const { model } = this.props;
        const { properties: { arrowType } } = model;
        const { stroke, strokeWidth } = this.getArrowStyle();
        const pathAttr = {
            stroke,
            strokeWidth
        }
        if (arrowType === 'empty') {  // ç©ºå¿ƒç®­å¤´
            return h('path', {
                ...pathAttr,
                fill: '#FFF',
                d: 'M -10 0  -20 -5 -30 0 -20 5 z'
            })
        } else if (arrowType === 'half') { // åŠç®­å¤´
            return (
                h('path', {
                    ...pathAttr,
                    d: 'M 0 0 -10 5'
                })
            )
        }
        return h('path', {
            ...pathAttr,
            d: 'M 0 0 -10 -5 -10 5 z'
        })
    }
}
```
---

**å¦‚æœçœ‹å®Œè§‰å¾—æœ‰æ”¶è·ï¼Œæ¬¢è¿ç‚¹èµã€è¯„è®ºã€åˆ†äº«æ”¯æŒä¸€ä¸‹ã€‚ä½ çš„æ”¯æŒå’Œè‚¯å®šï¼Œæ˜¯æˆ‘åšæŒå†™ä½œçš„åŠ¨åŠ›~**
