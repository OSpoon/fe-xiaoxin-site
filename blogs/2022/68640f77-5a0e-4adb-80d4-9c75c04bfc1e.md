---
title: èµ°è¿›â€œyarn create viteâ€çš„æºç å­¦ä¹ 
date: '2022-09-27 09:26'
sidebar: 'auto'
categories:
 - vite
tags:
 - create-vite
---

:::tip
æ‘˜è¦~
:::

<!-- more -->

## 1. å‰è¨€
------

å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯[å°é‘«åŒå­¦](https://it200.cn/ "https://it200.cn/")ã€‚ä¸€ä½ä»äº‹è¿‡**Androidå¼€å‘**ã€**æ··åˆå¼€å‘**ï¼Œç°åœ¨é•¿æœŸä»äº‹**å‰ç«¯å¼€å‘**çš„ç¼–ç¨‹çˆ±å¥½è€…ï¼Œ**æˆ‘è§‰å¾—åœ¨ç¼–ç¨‹ä¹‹è·¯ä¸Šæœ€é‡è¦çš„æ˜¯çŸ¥è¯†çš„åˆ†äº«ï¼Œæ‰€è°“ä¸‰äººè¡Œå¿…æœ‰æˆ‘å¸ˆ**ã€‚æ‰€ä»¥æˆ‘å¼€å§‹åœ¨ç¤¾åŒºæŒç»­è¾“å‡ºæˆ‘æ‰€äº†è§£åˆ°ã€å­¦ä¹ åˆ°ã€å·¥ä½œä¸­é‡åˆ°çš„å„ç§ç¼–ç¨‹çŸ¥è¯†ï¼Œæ¬¢è¿æœ‰æƒ³æ³•ã€æœ‰åŒæ„Ÿçš„ä¼™ä¼´åŠ æˆ‘[fe-xiaoxin](https://it200.cn/ "https://it200.cn/")å¾®ä¿¡äº¤æµ~

æˆ‘ä»¬åœ¨ç¼–ç¨‹å­¦ä¹ çš„è¿‡ç¨‹ä¸­ä¹Ÿä¼šå†™ä¸€äº›é¡¹ç›®çš„æ¨¡æ¿ï¼Œè¿™æ ·çš„æ¨¡æ¿åœ¨åæœŸå…¶å®å¹¶æ²¡æœ‰è¿›è¡Œå¾ˆå¥½çš„ç®¡ç†ï¼Œä»¥è‡³äºä¸‹æ¬¡å†æ¥å›é¡¾æˆ–ä½¿ç”¨çš„æ—¶å€™è¿˜éœ€è¦ä»â€œé›¶â€å¼€å§‹ï¼Œåœ¨ä½¿ç”¨è¿‡ [Vite](https://github.com/vitejs/vite) æ¥åˆ›å»ºé¡¹ç›®åé¡ºä¾¿æ‹¿çœ‹äº†ä¸€ä¸‹ä»“åº“ä¸­`create-vite`åŒ…ä¸­çš„æºç ï¼Œå¾—åˆ°äº†å¾ˆå¥½çš„å¯å‘~
## 2. èµ°è¿›â€œyarn create viteâ€çš„æºç 
### 2.1 Vite åˆ›å»ºé¡¹ç›®çš„æ–¹å¼ï¼š

1. ç»ˆç«¯äº¤äº’æ–¹å¼åˆ›å»ºé¡¹ç›®ï¼›
2. ç»ˆç«¯æŒ‡å®šæ¨¡ç‰ˆåˆ›å»ºé¡¹ç›®ï¼›
#### 2.1.1 ç»ˆç«¯äº¤äº’æ–¹å¼åˆ›å»ºé¡¹ç›®ï¼š
ç›¸æ¯”äºä»¥å¾€çš„ CLI å·¥å…·æä¾›çš„åˆ›å»ºé¡¹ç›®éƒ½éœ€è¦ä¼˜å…ˆæ‰‹åŠ¨å®‰è£… CLI å·¥å…·åå†æ‰§è¡Œå¯¹åº”çš„åˆ›å»ºå‘½ä»¤ï¼Œå¦ä¸€ç§å°±æ˜¯ Vite ç›®å‰é‡‡ç”¨çš„ç›´æ¥é€šè¿‡åŒ…ç®¡ç†å™¨å†…ç½®å‘½ä»¤ä½¿ç”¨ç»Ÿä¸€çš„è§„èŒƒæ¥å®ç°é¡¹ç›®çš„å¿«é€Ÿåˆ›å»ºï¼›
å¦‚æœä½ ä½¿ç”¨ YARNï¼š
```javascript
# yarn
yarn create vite
```
æ¥ä¸‹æ¥å°±å¯ä»¥æŒ‰ç»ˆç«¯æç¤ºè¿›è¡Œé¡¹ç›®åç§°çš„å½•å…¥å’Œé¡¹ç›®æ¨¡æ¿çš„é€‰æ‹©äº†~
#### 2.1.2 ç»ˆç«¯æŒ‡å®šæ¨¡ç‰ˆåˆ›å»ºé¡¹ç›®ï¼š
å¦‚æœæˆ‘ä»¬å¾ˆæ˜ç¡®å†…ç½®çš„æ¨¡æ¿é€‰é¡¹çš„è¯æˆ‘ä»¬å¯ä»¥åœ¨ç»ˆç«¯æ‰§è¡Œæ—¶åŒæ—¶å½•å…¥é¡¹ç›®åç§°å’Œæ¨¡æ¿åç§°æ›´å¿«é€Ÿçš„åˆ›å»ºé¡¹ç›®ï¼›
```javascript
# yarn
yarn create vite my-vue-app --template vue
```
å¤‡æ³¨ï¼šä½¿ç”¨â€œ`.`â€æ¥åœ¨å½“å‰ç›®å½•åˆ›å»ºé¡¹ç›®ï¼›
### 2.2 æºç åˆ†æï¼š

1. ç»ˆç«¯å‚æ•°è§£æï¼›
2. äº¤äº’æ”¶é›†æ•°æ®ï¼›
3. ç›®å½•åˆå§‹åŒ–ï¼›
4. æ‹·è´æ¨¡æ¿æ–‡ä»¶å¤¹ï¼›
5. é‡å†™ `gitignore` åç§°ï¼›
6. é‡å†™ `package` å­—æ®µï¼›
7. åç»­æ“ä½œæç¤ºï¼›
#### 2.2.1 ç»ˆç«¯å‚æ•°è§£æï¼š
é€šè¿‡ [minimist](https://www.npmjs.com/package/minimist) æ¨¡å—å°†ç»ˆç«¯å‚æ•°è§£æä¸ºå¯¹è±¡å½¢å¼ï¼š
```javascript
const argv = minimist<{
  t?: string
  template?: string
}>(process.argv.slice(2), { string: ['_'] })
```
é€šè¿‡è¯»å–å¯¹è±¡å±æ€§æ¥å¾—åˆ° argTargetDir å’Œ argTemplate ä¸¤ä¸ªå‚æ•°ï¼š
```javascript
const argTargetDir = formatTargetDir(argv._[0])
const argTemplate = argv.template || argv.t
```
#### 2.2.2 äº¤äº’æ”¶é›†æ•°æ®ï¼š
é€šè¿‡äº¤äº’æ”¶é›†çš„æ•°æ®åŒ…æ‹¬ï¼šprojectNameã€overwriteã€packageNameã€frameworkã€variantï¼š
**projectName**ï¼šé»˜è®¤å€¼æ˜¯ defaultTargetDir ï¼Œå¯¹åº”çš„å€¼æ˜¯`vite-project`ï¼Œå½“é€šè¿‡ç»ˆç«¯è§£æåˆ° argTargetDir åå°†è·³è¿‡æ­¤æ­¥éª¤ï¼›
```javascript
{
  type: argTargetDir ? null : 'text',
  name: 'projectName',
  message: reset('Project name:'),
  initial: defaultTargetDir,
  onState: (state) => {
    targetDir = formatTargetDir(state.value) || defaultTargetDir
  }
}
```
**overwrite**ï¼šåœ¨ç¡®è®¤å¥½ targetDir å‚æ•°åï¼Œæˆ‘ä»¬è¦çœ‹ targetDir å¯¹åº”çš„æ–‡ä»¶å¤¹æ˜¯å¦å­˜åœ¨æˆ–æ˜¯æ–‡ä»¶å¤¹ä¸­æ˜¯å¦æœ‰æ–‡ä»¶ï¼Œè¦æç¤ºç”¨æˆ·æ˜¯å¦éœ€è¦æƒ…å†µæˆ–ç»ˆç«¯æ“ä½œï¼›
```javascript
{
  type: () =>
    !fs.existsSync(targetDir) || isEmpty(targetDir) ? null : 'confirm',
  name: 'overwrite',
  message: () =>
    (targetDir === '.'
      ? 'Current directory'
      : `Target directory "${targetDir}"`) +
    ` is not empty. Remove existing files and continue?`
},
{
  type: (_, { overwrite }: { overwrite?: boolean }) => {
    if (overwrite === false) {
      throw new Error(red('âœ–') + ' Operation cancelled')
    }
    return null
  },
  name: 'overwriteChecker'
}
```
**packageName**ï¼špackageName çš„å€¼é€šè¿‡ **è·¯å¾„** å’Œ **targetDir **æ¥ç¡®å®šï¼Œåœ¨ç»ˆç«¯äº¤äº’æ”¶é›†æ•°æ®çš„æ—¶å€™éœ€è¦å¯¹å€¼åšæ ¼å¼çš„æ ¡éªŒæ¥ç¡®å®šåˆæ³•æ€§ï¼›
```javascript
// ç¡®å®šé¡¹ç›®åç§°
const getProjectName = () =>
    targetDir === '.' ? path.basename(path.resolve()) : targetDir

// æ ¡éªŒé¡¹ç›®åç§°åˆæ³•æ€§
{
  type: () => (isValidPackageName(getProjectName()) ? null : 'text'),
  name: 'packageName',
  message: reset('Package name:'),
  initial: () => toValidPackageName(getProjectName()),
  validate: (dir) =>
    isValidPackageName(dir) || 'Invalid package.json name'
}
```
**framework**ï¼šå¦‚æœç»ˆç«¯å·²è·å–åˆ° argTemplate å‚æ•°ï¼Œä¸”å·²å†…ç½®è¯¥æ¨¡æ¿å°†è·³è¿‡è¿™æ­¥ï¼Œå¦åˆ™å°†è¿›è¡Œé¢„ç½®æ¨¡æ¿é…ç½®çš„è§£æå¹¶é€‰æ‹©ï¼›
```javascript
{
  type:
    argTemplate && TEMPLATES.includes(argTemplate) ? null : 'select',
  name: 'framework',
  message:
    typeof argTemplate === 'string' && !TEMPLATES.includes(argTemplate)
      ? reset(
          `"${argTemplate}" isn't a valid template. Please choose from below: `
        )
      : reset('Select a framework:'),
  initial: 0,
  choices: FRAMEWORKS.map((framework) => {
    const frameworkColor = framework.color
    return {
      title: frameworkColor(framework.display || framework.name),
      value: framework
    }
  })
}
```
**variant**ï¼šé€šè¿‡ä¸Šä¸€æ­¥å¾—åˆ°çš„ framework å‚æ•°å°†ç¡®å®šè¿™ä¸ªæ­¥çš„é…ç½®ï¼Œå› ä¸ºåŒæ ·çš„ framework çœ‹ä¸€é…ç½®å¤šç§ variant ï¼›
```javascript
{
  type: (framework: Framework) =>
    framework && framework.variants ? 'select' : null,
  name: 'variant',
  message: reset('Select a variant:'),
  choices: (framework: Framework) =>
    framework.variants.map((variant) => {
      const variantColor = variant.color
      return {
        title: variantColor(variant.display || variant.name),
        value: variant.name
      }
    })
}
```
#### 2.2.3 ç›®å½•åˆå§‹åŒ–ï¼š
ç›®å½•å¦‚æœä¸å­˜åœ¨çš„è¯æˆ‘ä»¬éœ€è¦åˆ›å»ºå¯¹åº”çš„ç›®å½•ï¼Œå› ä¸ºåœ¨å‰æœŸæ”¶é›†å‚æ•°å¯èƒ½æ˜¯ä¸ªç›®å½•ï¼Œè¿™å„¿åˆ›å»ºçš„æ—¶å€™éœ€è¦é€’å½’åˆ›å»ºï¼Œä½†æ˜¯å½“ç›®å½•å­˜åœ¨ä¸”æœ‰å†…å®¹çš„æ—¶å€™æˆ‘ä»¬å°±éœ€è¦æ¸…ç©ºæ‰é‡Œé¢çš„æ–‡ä»¶äº†ï¼Œä½†æ˜¯åœ¨æ¸…ç©ºçš„æ—¶å€™æˆ‘ä»¬è¦è€ƒè™‘å½“æ—¶ç›®å½•å¯èƒ½å·²ç»è¢«ç‰ˆæœ¬ç®¡ç†è¿‡äº†ï¼Œæ‰€ä»¥éœ€è¦å¯¹`.git`ç›®å½•è¿‡æ»¤æ‰ï¼Œè¿™æ ·æ‰æ›´å®Œæ•´ï¼›
```javascript
const root = path.join(cwd, targetDir)

if (overwrite) {
  emptyDir(root)
} else if (!fs.existsSync(root)) {
  fs.mkdirSync(root, { recursive: true })
}
```
#### 2.2.4 æ‹·è´æ¨¡æ¿æ–‡ä»¶å¤¹ï¼š
æ¨¡æ¿æ‹·è´çš„æ—¶å€™éœ€è¦è¿‡æ»¤æ‰`package.json`ï¼Œæˆ‘ä»¬ä¼šåœ¨åé¢å•ç‹¬è¿›è¡Œå¤„ç†ï¼›
```javascript
const files = fs.readdirSync(templateDir)
for (const file of files.filter((f) => f !== 'package.json')) {
  write(file)
}
```
#### 2.2.5 é‡å†™ `gitignore` åç§°ï¼š
åœ¨ä¸Šä¸€æ­¥çš„æ¨¡æ¿æ–‡ä»¶å¤¹æ‹·è´çš„æ—¶å€™å·²ç»ç”¨åˆ°äº†è¿™ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬è¿™é‡Œå…³ç³»ç¬¬äºŒè¡Œä¸­çš„å…³é”®å¯¹è±¡ renameFiles ï¼Œå®é™…ä¸Šå°±æ˜¯è¦å°† _gitignore é‡å‘½åä¸º .gitignore ï¼Œå› ä¸ºåœ¨æ¨¡æ¿ä¸­ç›´æ¥ä½¿ç”¨ .gitignore å¯èƒ½å°±å¯¼è‡´å…³èŠ‚çš„æ–‡ä»¶è¢«ä¸¢å¤±æ‰äº†ï¼›
```javascript
const write = (file: string, content?: string) => {
  const targetPath = path.join(root, renameFiles[file] ?? file)
  if (content) {
    fs.writeFileSync(targetPath, content)
  } else {
    copy(path.join(templateDir, file), targetPath)
  }
}
```
#### 2.2.6 é‡å†™ `package` å­—æ®µï¼š
æœ€åæ¥è¾“å‡º package.json ï¼Œéœ€è¦æ”¹å˜é‡Œé¢çš„å†…å®¹ï¼Œå°¤å…¶æ˜¯é‡è¦çš„é¡¹ç›®åç§°ï¼Œå‘½åè§„èŒƒä¹Ÿæ˜¯ä¸ºäº†ç¬¦åˆ package ä¸­ name çš„è§„åˆ™ï¼›
```javascript
const pkg = JSON.parse(
  fs.readFileSync(path.join(templateDir, `package.json`), 'utf-8')
)

pkg.name = packageName || getProjectName()

write('package.json', JSON.stringify(pkg, null, 2))
```
#### 2.2.7 åç»­æ“ä½œæç¤ºï¼š
åœ¨æ¨¡æ¿æ‹·è´å®Œæ¯•åé¡¹ç›®çš„åˆ›å»ºé˜¶æ®µä¹Ÿå°±ç»“æŸäº†ï¼Œæ¥ç€å°±æ˜¯åˆ¤æ–­åœ¨ç»ˆç«¯æ‰§è¡Œçš„åŒ…ç®¡ç†å™¨æ¥æç¤ºç”¨æˆ·ä¸‹ä¸€æ­¥çš„æ“ä½œäº†~
```javascript
const pkgInfo = pkgFromUserAgent(process.env.npm_config_user_agent)
const pkgManager = pkgInfo ? pkgInfo.name : 'npm'

switch (pkgManager) {
  case 'yarn':
    console.log('  yarn')
    console.log('  yarn dev')
    break
  default:
    console.log(`  ${pkgManager} install`)
    console.log(`  ${pkgManager} run dev`)
    break
}
```
## 3. æ€»ç»“
åœ¨æºç ä¸­è¿˜æ”¯æŒäº†ç¬¬ä¸‰æ–¹æ¨¡æ¿é€šè¿‡è‡ªå®šä¹‰å‘½ä»¤æ¥åˆ›å»ºé¡¹ç›®ï¼Œå…³é”®è¯å¯ä»¥æœç´¢ `customCommand` ï¼Œæ•´ä½“æºç æ˜¯å¾ˆç®€å•çš„ï¼Œä½ å‡†å¤‡å¥½ä¸ºè‡ªå·±åˆ›å»ºä¸€å¥—æ¨¡æ¿ç®¡ç†å·¥å…·äº†å—~

* * *

**å¦‚æœçœ‹å®Œè§‰å¾—æœ‰æ”¶è·ï¼Œæ¬¢è¿ç‚¹èµã€è¯„è®ºã€åˆ†äº«æ”¯æŒä¸€ä¸‹ã€‚ä½ çš„æ”¯æŒå’Œè‚¯å®šï¼Œæ˜¯æˆ‘åšæŒå†™ä½œçš„åŠ¨åŠ›~**

æœ€åå¯ä»¥å…³æ³¨æˆ‘@å°é‘«åŒå­¦ã€‚æ¬¢è¿[ç‚¹æ­¤æ‰«ç åŠ æˆ‘å¾®ä¿¡](https://it200.cn/ "https://it200.cn/")[fe-xiaoxin](https://it200.cn/ "https://it200.cn/")äº¤æµï¼Œå…±åŒè¿›æ­¥ï¼ˆè¿˜å¯ä»¥å¸®ä½ **fix**ğŸ›ï¼‰~