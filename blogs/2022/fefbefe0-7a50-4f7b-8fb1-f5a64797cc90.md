---
title: åª’ä½“è®¾å¤‡æšä¸¾
date: '2022-06-06 22:54'
sidebar: 'auto'
categories:
 - 
tags:
 - 
---

:::tip
å‰å‡ èŠ‚æˆ‘ä»¬éƒ½æ˜¯ä½¿ç”¨çš„é»˜è®¤çš„éŸ³è§†é¢‘è®¾å¤‡æ¥è¿›è¡Œåª’ä½“æ•°æ®çš„è¾“å‡ºï¼Œæˆ‘ä»¬è¿™ä¸€èŠ‚å°±å°†ç³»ç»Ÿä¸­å¯ä»¥ä½¿ç”¨çš„éŸ³é¢‘è¾“å…¥ã€è¾“å‡ºè®¾å¤‡åŠè§†é¢‘è¾“å…¥è®¾å¤‡åˆ—ä¸¾å‡ºæ¥å¹¶è¿›è¡Œåˆ‡æ¢ã€‚
:::

<!-- more -->

## å‰è¨€
------

å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯[å°é‘«åŒå­¦](https://it200.cn/ "https://it200.cn/")ã€‚ä¸€ä½ä»äº‹è¿‡**Androidå¼€å‘**ã€**æ··åˆå¼€å‘**ï¼Œç°åœ¨é•¿æœŸä»äº‹**å‰ç«¯å¼€å‘**çš„ç¼–ç¨‹çˆ±å¥½è€…ï¼Œ**æˆ‘è§‰å¾—åœ¨ç¼–ç¨‹ä¹‹è·¯ä¸Šæœ€é‡è¦çš„æ˜¯çŸ¥è¯†çš„åˆ†äº«ï¼Œæ‰€è°“ä¸‰äººè¡Œå¿…æœ‰æˆ‘å¸ˆ**ã€‚æ‰€ä»¥æˆ‘å¼€å§‹åœ¨ç¤¾åŒºæŒç»­è¾“å‡ºæˆ‘æ‰€äº†è§£åˆ°ã€å­¦ä¹ åˆ°ã€å·¥ä½œä¸­é‡åˆ°çš„å„ç§ç¼–ç¨‹çŸ¥è¯†ï¼Œæ¬¢è¿æœ‰æƒ³æ³•ã€æœ‰åŒæ„Ÿçš„ä¼™ä¼´åŠ æˆ‘[fe-xiaoxin](https://it200.cn/ "https://it200.cn/")å¾®ä¿¡äº¤æµ~

## å†™ä½œèƒŒæ™¯ï¼š

å‰å‡ èŠ‚æˆ‘ä»¬éƒ½æ˜¯ä½¿ç”¨çš„é»˜è®¤çš„éŸ³è§†é¢‘è®¾å¤‡æ¥è¿›è¡Œåª’ä½“æ•°æ®çš„è¾“å‡ºï¼Œæˆ‘ä»¬è¿™ä¸€èŠ‚å°±å°†ç³»ç»Ÿä¸­å¯ä»¥ä½¿ç”¨çš„éŸ³é¢‘è¾“å…¥ã€è¾“å‡ºè®¾å¤‡åŠè§†é¢‘è¾“å…¥è®¾å¤‡åˆ—ä¸¾å‡ºæ¥å¹¶è¿›è¡Œåˆ‡æ¢ã€‚

## æ¶‰åŠ APIï¼š

æšä¸¾è®¾å¤‡çš„ API æ˜¯ `navigator.mediaDevices.enumerateDevices()`ï¼Œå®ƒå°†ä¼šå¼‚æ­¥å›è°ƒç»™æˆ‘ä»¬ä¸€ä¸ª MediaDeviceInfo æ•°ç»„ï¼Œæ¯ä¸ª MediaDeviceInfo å°†åŒ…å«ä¸€ä¸ªè®¾å¤‡çš„ deviceId ï¼Œè®¾å¤‡åç§° label ï¼Œè®¾å¤‡çš„ç±»å‹ kind ã€‚è®¾å¤‡ç±»å‹åŒ…æ‹¬ï¼šaudioinputï¼ˆéŸ³é¢‘è¾“å…¥ï¼‰ï¼Œaudiooutputï¼ˆéŸ³é¢‘è¾“å‡ºï¼‰ï¼Œvideoinputï¼ˆè§†é¢‘è¾“å…¥ï¼‰ã€‚

```
// è·å–å½“å‰è®¡ç®—æœºå¯åˆ—ä¸¾çš„éŸ³é¢‘è¾“å…¥|è¾“å‡º|è§†é¢‘è¾“å…¥è®¾å¤‡
navigator.mediaDevices
  .enumerateDevices()
  .then((devices) => {
  for (const device of devices) {
    if (device.kind === "audioinput") {
      audioInputDevices.push(device);
    } else if (device.kind === "audiooutput") {
      audioOutputDevices.push(device);
    } else if (device.kind === "videoinput") {
      videoDevices.push(device);
    }
  }
})
  .then(() => {
  resolve({ audioInputDevices, audioOutputDevices, videoDevices });
});
```

æ³¨ï¼šå½“ç”¨æˆ·é€‰æ‹©å®Œè®¾å¤‡åæœ€å¥½æ”¯æŒä¿å­˜é…ç½®ï¼Œçœå»ä¸‹æ¬¡è°ƒæ•´ï¼Œå› ä¸ºç”¨æˆ·çš„åå¥½å’Œè®¾å¤‡æ—¶å€™æ•…éšœéƒ½ä¼šå½±å“åˆ°ç”¨æˆ·çš„å®é™…ä½¿ç”¨ã€‚

`HTMLMediaElement.setSinkId()`API æ˜¯ä¸€ä¸ªå®éªŒåŠŸèƒ½ï¼Œå¯ä»¥é€šè¿‡ä¼ å…¥ä¸€ä¸ªéŸ³é¢‘è¾“å‡ºè®¾å¤‡çš„ deviceId æ¥åˆ‡æ¢ä¸åŒçš„éŸ³é¢‘è¾“å‡ºè®¾å¤‡ï¼š

```
const handleChangeAudioOutputDevice = (value: string) => {
  selectedAudioOutputDevice.value = value;
  video
    // @ts-ignore
    .value!.setSinkId(value)
    .then(() => {
      console.log(`éŸ³é¢‘è¾“å‡ºè®¾å¤‡è®¾ç½®æˆåŠŸ${value}`);
    })
    .catch((error: Error) => {
      console.log(error);
    });
};
```

æ³¨ï¼šå®é™…å¼€å‘æ—¶åœ¨ HTMLMediaElement æ¥å£ä¸­æ²¡èƒ½æ‰¾åˆ° setSinkId å‡½æ•°ï¼Œä½†åŠŸèƒ½æ­£å¸¸ï¼Œè¿™é‡Œå…ˆä½¿ç”¨ `@ts-ignore`å°†ä¸‹ä¸€è¡Œçš„é”™è¯¯å¿½ç•¥ã€‚

## å¯åŠ¨è®¾å¤‡ï¼š

åœ¨è¿™é‡Œæˆ‘ä»¬è¦æ‰©å±•çº¦æŸæ¡ä»¶ï¼Œä»¥æ”¯æŒä½¿ç”¨é»˜è®¤é€‰æ‹©çš„å„è®¾å¤‡ï¼š

```
const openDevice = () => {
  const constraints: MediaStreamConstraints = {
    audio: {
      deviceId: selectedAudioInputDevice.value
        ? { exact: selectedAudioInputDevice.value }
        : undefined,
    },
    video: {
      deviceId: selectedVideoDevice.value
        ? { exact: selectedVideoDevice.value }
        : undefined,
    },
  };
  ...
};
```

æ³¨ï¼š
   1. å¼ºçƒˆæ¨èä½¿ç”¨ TypeScript æ¥å¼€å‘ï¼Œå¹¶æŒ‡å®šçœŸå®çš„ç±»å‹æ¥å¾—åˆ°ä¼˜ç§€çš„ä»£ç æç¤ºï¼›
   2. å…¶ä»–æ­¥éª¤åŒå‰å‡ èŠ‚çš„æ–¹å¼ï¼Œä¹Ÿå¯ä»¥çœ‹æ–‡æœ«çš„å®Œæ•´ä»£ç ã€‚

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/155e0173046048ab88e57d388f68e2c5~tplv-k3u1fbpfcp-zoom-1.image)


å®Œæ•´ä»£ç ï¼š[Resolution.vue](https://github.com/OSpoon/webrtc-vue3/blob/master/src/views/parameter-settings/children/Resolution.vue)

## ç»“è¯­ï¼š

æˆ‘ä»¬é€šè¿‡ enumerateDevices çš„åˆ°äº†ç³»ç»Ÿä¸­å·²å­˜åœ¨çš„éŸ³é¢‘è¾“å…¥ã€è¾“å‡ºè®¾å¤‡åŠè§†é¢‘çš„è¾“å…¥è®¾å¤‡ï¼Œåœ¨è§†é¢‘ä¼šè®®ç­‰è½¯ä»¶ä¸­ä¹Ÿéœ€è¦æ”¯æŒå¤šç§è®¾å¤‡çš„åˆ‡æ¢æ¥æ»¡è¶³ä¸åŒçš„åœºæ™¯ã€‚

* * *

**å¦‚æœçœ‹å®Œè§‰å¾—æœ‰æ”¶è·ï¼Œæ¬¢è¿ç‚¹èµã€è¯„è®ºã€åˆ†äº«æ”¯æŒä¸€ä¸‹ã€‚ä½ çš„æ”¯æŒå’Œè‚¯å®šï¼Œæ˜¯æˆ‘åšæŒå†™ä½œçš„åŠ¨åŠ›~**

æœ€åå¯ä»¥å…³æ³¨æˆ‘@å°é‘«åŒå­¦ã€‚æ¬¢è¿[ç‚¹æ­¤æ‰«ç åŠ æˆ‘å¾®ä¿¡](https://it200.cn/ "https://it200.cn/")[fe-xiaoxin](https://it200.cn/ "https://it200.cn/")äº¤æµï¼Œå…±åŒè¿›æ­¥ï¼ˆè¿˜å¯ä»¥å¸®ä½ **fix**ğŸ›ï¼‰~