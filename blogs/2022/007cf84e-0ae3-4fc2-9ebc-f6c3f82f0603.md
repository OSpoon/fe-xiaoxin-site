---
title: åª’ä½“æ•°æ®è·å–ä¸æ’­æ”¾
date: '2022-06-03 23:37'
sidebar: 'auto'
categories:
 - 
tags:
 - 
---

:::tip
åœ¨å­¦ä¹  WebRTC éŸ³è§†é¢‘å¼€å‘å‰ï¼Œæˆ‘ä»¬å…ˆæ¥å­¦ä¹ äº†è§£ä¸€ä¸‹éŸ³é¢‘ã€è§†é¢‘ç­‰åª’ä½“æ•°æ®çš„è·å–ä¸æ’­æ”¾ã€‚äº†è§£ä¸€ä¸‹å…¥é—¨çº§çš„ API çš„ä½¿ç”¨ã€‚
:::

<!-- more -->

## å‰è¨€
------

å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯[å°é‘«åŒå­¦](https://it200.cn/ "https://it200.cn/")ã€‚ä¸€ä½ä»äº‹è¿‡**Androidå¼€å‘**ã€**æ··åˆå¼€å‘**ï¼Œç°åœ¨é•¿æœŸä»äº‹**å‰ç«¯å¼€å‘**çš„ç¼–ç¨‹çˆ±å¥½è€…ï¼Œ**æˆ‘è§‰å¾—åœ¨ç¼–ç¨‹ä¹‹è·¯ä¸Šæœ€é‡è¦çš„æ˜¯çŸ¥è¯†çš„åˆ†äº«ï¼Œæ‰€è°“ä¸‰äººè¡Œå¿…æœ‰æˆ‘å¸ˆ**ã€‚æ‰€ä»¥æˆ‘å¼€å§‹åœ¨ç¤¾åŒºæŒç»­è¾“å‡ºæˆ‘æ‰€äº†è§£åˆ°ã€å­¦ä¹ åˆ°ã€å·¥ä½œä¸­é‡åˆ°çš„å„ç§ç¼–ç¨‹çŸ¥è¯†ï¼Œæ¬¢è¿æœ‰æƒ³æ³•ã€æœ‰åŒæ„Ÿçš„ä¼™ä¼´åŠ æˆ‘[fe-xiaoxin](https://it200.cn/ "https://it200.cn/")å¾®ä¿¡äº¤æµ~

## å†™ä½œèƒŒæ™¯ï¼š

&ensp;&ensp;&ensp;&ensp; åœ¨å­¦ä¹  WebRTC éŸ³è§†é¢‘å¼€å‘å‰ï¼Œæˆ‘ä»¬å…ˆæ¥å­¦ä¹ äº†è§£ä¸€ä¸‹éŸ³é¢‘ã€è§†é¢‘ç­‰åª’ä½“æ•°æ®çš„è·å–ä¸æ’­æ”¾ã€‚äº†è§£ä¸€ä¸‹å…¥é—¨çº§çš„ API çš„ä½¿ç”¨ã€‚

## API ä»‹ç»ï¼š

### MediaDevicesï¼š

&ensp;&ensp;&ensp;&ensp; <https://developer.mozilla.org/zh-CN/docs/Web/API/MediaDevices>

&ensp;&ensp;&ensp;&ensp; è¿™ä¸ª API æä¾›äº†å¦‚ä½•è®¿é—®åª’ä½“æ•°æ®è¾“å…¥çš„è®¾å¤‡ï¼Œå¦‚ PC ç”µè„‘çš„æ‘„åƒå¤´ã€éº¦å…‹é£ã€å±å¹•å…±äº«ç­‰ã€‚

### MediaDevices.getUserMedia()ï¼š

&ensp;&ensp;&ensp;&ensp; é€šè¿‡ä¼ å…¥ä¸åŒçš„çº¦æŸææ¡ä»¶æ¥è·å–åˆ°ä¸åŒçš„åª’ä½“æ•°æ®æµï¼Œå‰æçš„ç”¨æˆ·æˆæƒä½¿ç”¨çš„æƒ…å†µä¸‹ã€‚ä½¿ç”¨åˆ°æ‘„åƒå¤´ã€éº¦å…‹é£æ—¶æµè§ˆå™¨å°±ä¼šå¯¹ç”¨æˆ·æç¤ºå¹¶å¸Œæœ›å¾—åˆ°ç”¨æˆ·æˆæƒã€‚

### MediaDevices.getDisplayMedia()ï¼š

&ensp;&ensp;&ensp;&ensp; åœ¨å¾—åˆ°ç”¨æˆ·æˆæƒåå¯ä»¥é€‰æ‹©å±å¹•ã€çª—å£ã€Chrome æ ‡ç­¾é¡µè¿›è¡Œåª’ä½“æµçš„è·å–ã€‚åœ¨è·å– Mac å±å¹•/çª—å£è¿›è¡Œå±å¹•å…±äº«çš„æ—¶å€™éœ€è¦åœ¨ Mac çš„ã€åå¥½è®¾ç½®ã€‘=>ã€å®‰å…¨ä¸éšç§ã€‘=>ã€éšç§ã€‘=>ã€å±å¹•å½•åˆ¶ã€‘ä¸­å‹¾é€‰å…è®¸Chromeã€‚

## è·å–æ‘„åƒå¤´è§†é¢‘æ•°æ®æµï¼š

1.  è®¾ç½®çº¦æŸæ¡ä»¶ï¼Œå…è®¸è§†é¢‘ï¼Œç¦ç”¨éŸ³é¢‘ï¼š

```
const constraints: MediaStreamConstraints = { audio: false, video: true };
```

2.  åŒæ­¥è°ƒç”¨getUserMediaå¾—åˆ°åª’ä½“æµï¼š

```
const stream = await navigator.mediaDevices.getUserMedia(constraints);
```

3.  é€šè¿‡åª’ä½“æµå¾—åˆ°è®¾å¤‡çš„ä¿¡æ¯ï¼Œå¦‚è®¾å¤‡åç§°ï¼š

```
const videoTracks = stream.getVideoTracks();
console.log(videoTracks[0].label);
```

4.  é€šè¿‡ video æ ‡ç­¾æ’­æ”¾åª’ä½“æµï¼Œè¿™é‡Œä¸é€‚ç”¨ src å±æ€§ï¼Œè¦ä½¿ç”¨ srcObject å±æ€§ï¼Œè¿™ä¸ªå±æ€§æ˜¯HTMLMediaElement ç±»çš„å…¶ä¸­ä¸€å‘˜ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ TypeScript ç¼–å†™ä»£ç çš„æ—¶å€™åœ¨æ³›å‹çº¦æŸæ—¶æŒ‡å®šäº†å®ƒï¼š

```
const video = ref<HTMLMediaElement>();

const openCamera = async () => {
  try {
    const constraints: MediaStreamConstraints = { audio: false, video: true };
    const stream = await navigator.mediaDevices.getUserMedia(constraints);
    const videoTracks = stream.getVideoTracks();
    console.log(videoTracks[0].label);
    video.value!.srcObject = stream;
  } catch (error) {
    message.error(`è·å–ç”¨æˆ·åª’ä½“æ•°æ®é”™è¯¯ï¼š${error}`);
  }
};

// videoå…ƒç´ å®šä¹‰
<video ref="video" autoplay></video>
```

## è·å–éº¦å…‹é£éŸ³é¢‘æ•°æ®æµï¼š

&ensp;&ensp;&ensp;&ensp; ä¸ä¸Šé¢è·å–æ‘„åƒå¤´åª’ä½“æ•°æ®ç±»ä¼¼ï¼Œåªæ˜¯ä½¿ç”¨ä¸åŒçš„çº¦æŸä¸ä¸åŒçš„æ’­æ”¾æ ‡ç­¾ï¼Œè¯·çœ‹å®Œæ•´ä»£ç ï¼š

```
const audio = ref<HTMLMediaElement>();

const openMicrophone = async () => {
  try {
    const constraints: MediaStreamConstraints = { audio: true, video: false };
    const stream = await navigator.mediaDevices.getUserMedia(constraints);
    const audioTracks = stream.getAudioTracks();
    console.log(audioTracks[0].label);
    audio.value!.srcObject = stream;
  } catch (error) {
    message.error(`è·å–ç”¨æˆ·åª’ä½“æ•°æ®é”™è¯¯ï¼š${error}`);
  }
};

// audioå…ƒç´ å®šä¹‰
<audio ref="audio" autoplay controls></audio>
```

## æˆªå–è§†é¢‘æµè¾“å…¥åˆ°ç”»å¸ƒï¼š

&ensp;&ensp;&ensp;&ensp; åœ¨è¿›è¡Œæ’­æ”¾æ‘„åƒå¤´æ•°æ®çš„è¿‡ç¨‹ä¸­æˆ‘ä»¬å¯ä»¥æˆªå–å…¶ä¸­çš„ä¸€ä¸ªç”»é¢è¾“å‡ºåˆ°ç”»å¸ƒä¸­ï¼Œè¿™ä¸ªæ¡ˆä¾‹å·¥ä½œå‰éœ€è¦æ­£å¸¸å¾—åˆ°æ‘„åƒå¤´è¿”å›çš„åª’ä½“æ•°æ®æµï¼š

&ensp;&ensp;&ensp;&ensp; å› ä¸ºæˆ‘ä»¬è¦å¾—åˆ° video æ ‡ç­¾çš„ä¸€ä¸ªå®½é«˜æ¥è®¾ç½®æˆ‘ä»¬çš„ç”»å¸ƒå°ºå¯¸ï¼Œæ‰€ä»¥åœ¨æ³›å‹çº¦æŸçš„æ—¶å€™æˆ‘ä»¬å¢åŠ ä¸€ä¸ªHTMLVideoElement ç±»å‹çº¦æŸï¼š

```
const captureVideo = async () => {
  const videoSource = video.value as HTMLVideoElement;
  canvas.value!.width = videoSource.videoWidth;
  canvas.value!.height = videoSource.videoHeight;
  canvas.value
    ?.getContext("2d")
    ?.drawImage(videoSource, 0, 0, canvas.value!.width, canvas.value!.height);
};

// canvaså…ƒç´ å®šä¹‰
<canvas ref="canvas"></canvas>
```

## é€šè¿‡æµè§ˆå™¨å…±äº«å±å¹•ï¼š

&ensp;&ensp;&ensp;&ensp; æˆ‘ä»¬è¿™é‡Œæœ‰å°‘è®¸çš„ä¸åŒï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ getDisplayMediaï¼Œä½†æ˜¯åŒæ ·å°†å¾—åˆ°çš„åª’ä½“æµäº¤ç”± video æ ‡ç­¾æ’­æ”¾ï¼š

```
const shareScreen = async () => {
  try {
    const stream = await navigator.mediaDevices.getDisplayMedia({
      video: true,
    });
    const videoTracks = stream.getVideoTracks();
    console.log(videoTracks[0].label);
    video.value!.srcObject = stream;
  } catch (error) {
    console.log((error as Error).name);
    message.error(`è·å–ç”¨æˆ·åª’ä½“æ•°æ®é”™è¯¯ï¼š${error}`);
  }
};

// videoå…ƒç´ å®šä¹‰
<video ref="video" autoplay></video>
```

æ³¨ï¼šæˆ‘ä»¬ä¸Šé¢æœ‰æåˆ°çš„ï¼Œå±å¹•å½•åˆ¶çš„æƒé™ï¼Œä¸€å®šè¦åœ¨ç³»ç»Ÿåå¥½ä¸­æå‰è®¾ç½®ï¼Œè¦ä¸ä½ çš„çœ‹åˆ° NotAllowedError: Permission denied by system çš„âŒé”™è¯¯æç¤ºã€‚

## ç»“è¯­ï¼š

&ensp;&ensp;&ensp;&ensp; é€šè¿‡ä¸Šé¢ 4 ä¸ªåœºæ™¯ç”¨ä¾‹æˆ‘ä»¬ç†Ÿæ‚‰äº†åœ¨æµè§ˆå™¨ä¸­é€šè¿‡è§„èŒƒçš„ API æ¥å®ç°åª’ä½“æ•°æ®çš„è¯»å–ä¸æ’­æ”¾ï¼Œå¤§å¤§èŠ‚çœäº†éŸ³è§†é¢‘åœ¨ web ç«¯å¼€å‘çš„éš¾åº¦ï¼Œæ˜å¤©ç»§ç»­å­¦ï¼

* * *

**å¦‚æœçœ‹å®Œè§‰å¾—æœ‰æ”¶è·ï¼Œæ¬¢è¿ç‚¹èµã€è¯„è®ºã€åˆ†äº«æ”¯æŒä¸€ä¸‹ã€‚ä½ çš„æ”¯æŒå’Œè‚¯å®šï¼Œæ˜¯æˆ‘åšæŒå†™ä½œçš„åŠ¨åŠ›~**

æœ€åå¯ä»¥å…³æ³¨æˆ‘@å°é‘«åŒå­¦ã€‚æ¬¢è¿[ç‚¹æ­¤æ‰«ç åŠ æˆ‘å¾®ä¿¡](https://it200.cn/ "https://it200.cn/")[fe-xiaoxin](https://it200.cn/ "https://it200.cn/")äº¤æµï¼Œå…±åŒè¿›æ­¥ï¼ˆè¿˜å¯ä»¥å¸®ä½ **fix**ğŸ›ï¼‰~