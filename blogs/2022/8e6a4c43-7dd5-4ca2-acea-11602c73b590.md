---
title: ã€Viteã€‘é…ç½®HTTPS&amp;è‡ªç­¾åè¯ä¹¦
date: '2022-06-02 22:34'
sidebar: 'auto'
categories:
 - Compiler
tags:
 - Vite
 - è‡ªç­¾åè¯ä¹¦
 - HTTP
---

:::tip
åœ¨å­¦ä¹ å¼€å‘ WebRTC ç›¸å…³çš„é¡¹ç›®çš„æ—¶å€™æ˜¯éœ€è¦ä½¿ç”¨åˆ° HTTPS å®‰å…¨åè®®æ‰èƒ½æ­£å¸¸å·¥ä½œçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨ Vite æ„å»ºçš„é¡¹ç›®ä¸­å¯ç”¨ HTTPS åè®®å¹¶ä¸”é…ç½®è¯ä¹¦æ–‡ä»¶ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒæ˜¯éœ€è¦ç”³è¯·å•†ç”¨ç‰ˆè¯ä¹¦ï¼ˆä»˜è´¹ï¼‰çš„ï¼Œæˆ‘ä»¬åœ¨æœ¬åœ°å¼€å‘çš„å·¥ç¨‹ä¸­å¯ä»¥ä½¿ç”¨è‡ªç­¾åçš„è¯ä¹¦æ¥æå®šã€‚
:::

<!-- more -->

## å‰è¨€
------

å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯[å°é‘«åŒå­¦](https://it200.cn/ "https://it200.cn/")ã€‚ä¸€ä½ä»äº‹è¿‡**Androidå¼€å‘**ã€**æ··åˆå¼€å‘**ï¼Œç°åœ¨é•¿æœŸä»äº‹**å‰ç«¯å¼€å‘**çš„ç¼–ç¨‹çˆ±å¥½è€…ï¼Œ**æˆ‘è§‰å¾—åœ¨ç¼–ç¨‹ä¹‹è·¯ä¸Šæœ€é‡è¦çš„æ˜¯çŸ¥è¯†çš„åˆ†äº«ï¼Œæ‰€è°“ä¸‰äººè¡Œå¿…æœ‰æˆ‘å¸ˆ**ã€‚æ‰€ä»¥æˆ‘å¼€å§‹åœ¨ç¤¾åŒºæŒç»­è¾“å‡ºæˆ‘æ‰€äº†è§£åˆ°ã€å­¦ä¹ åˆ°ã€å·¥ä½œä¸­é‡åˆ°çš„å„ç§ç¼–ç¨‹çŸ¥è¯†ï¼Œæ¬¢è¿æœ‰æƒ³æ³•ã€æœ‰åŒæ„Ÿçš„ä¼™ä¼´åŠ æˆ‘[fe-xiaoxin](https://it200.cn/ "https://it200.cn/")å¾®ä¿¡äº¤æµ~

## å†™ä½œèƒŒæ™¯ï¼š

&ensp;&ensp;&ensp;&ensp; åœ¨å­¦ä¹ å¼€å‘ **WebRTC** ç›¸å…³çš„é¡¹ç›®çš„æ—¶å€™æ˜¯éœ€è¦ä½¿ç”¨åˆ° **HTTPS** å®‰å…¨åè®®æ‰èƒ½æ­£å¸¸å·¥ä½œçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨ **Vite** æ„å»ºçš„é¡¹ç›®ä¸­å¯ç”¨ **HTTPS** åè®®å¹¶ä¸”é…ç½®è¯ä¹¦æ–‡ä»¶ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒæ˜¯éœ€è¦ç”³è¯·å•†ç”¨ç‰ˆè¯ä¹¦ï¼ˆä»˜è´¹ï¼‰çš„ï¼Œæˆ‘ä»¬åœ¨æœ¬åœ°å¼€å‘çš„å·¥ç¨‹ä¸­å¯ä»¥ä½¿ç”¨è‡ªç­¾åçš„è¯ä¹¦æ¥æå®šã€‚

## å¦‚ä½•å¯ç”¨ HTTPSï¼š

### ä»…å¯ç”¨ HTTPSï¼š

&ensp;&ensp;&ensp;&ensp; **Vite** æ„å»ºçš„é¡¹ç›®é»˜è®¤æ˜¯ä½¿ç”¨çš„ **HTTP** åè®®ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ **vite** çš„é…ç½®æ–‡ä»¶è¿›è¡Œé…ç½®å¯ç”¨ï¼Œä¸‹å›¾æ˜¯æˆ‘åœ¨ **vite** æ–‡æ¡£ä¸­æ‰¾åˆ°çš„æˆªå›¾ï¼š

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6e3faa2d643745088d9dd069f4ec64d2~tplv-k3u1fbpfcp-zoom-1.image)

&ensp;&ensp;&ensp;&ensp; æˆ‘ä»¬å¯ä»¥åœ¨å°†è¿™ä¸ªå±æ€§é…ç½®ä¸º **true** æ¥å¼€å¯ **HTTPS** åè®®ï¼Œé…ç½®åå¹¶é‡å¯æœåŠ¡å°±å¯ä»¥çœ‹åˆ°åœ¨ **CLI** ä¸­æç¤ºçš„æœåŠ¡åœ°å€å˜æˆäº† **HTTPS** ï¼Œå½“ä½ åœ¨æµè§ˆå™¨æ‰“å¼€è¿™ä¸ªåœ°å€çš„æ—¶å€™ä½ ä¼šå‘ç°è¢«æµè§ˆå™¨æ‹¦æˆªäº†ï¼Œè¯ä¹¦æ— æ•ˆã€‚

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c2433b7cabc749a8819af382e29916a4~tplv-k3u1fbpfcp-zoom-1.image)

### é…ç½®è¯ä¹¦è¯´æ˜ï¼š

&ensp;&ensp;&ensp;&ensp; ä»…ä»…å¯ç”¨äº† **HTTPS** æ— æ³•æ»¡è¶³æˆ‘ä»¬çš„è¦æ±‚ï¼ˆä¿®æ”¹æµè§ˆå™¨è®¾ç½®ä¸ºä¸ä¿æŠ¤é™¤å¤–ï¼‰ï¼Œæˆ‘ä»¬è¿˜éœ€è¦é…ç½®æœ‰æ•ˆçš„è¯ä¹¦æ‰å¯ä»¥ï¼Œ`server.https`é™¤äº†æ”¯æŒ **Boolean** ç±»å‹ä»¥å¤–ï¼Œè¿˜æ”¯æŒä¼ å…¥ä¸€ä¸ª `https.createServer`çš„é€‰é¡¹ï¼Œä¸‹å›¾æ˜¯ **vite** æ–‡æ¡£å¼•å¯¼åˆ° **Nodejs** çš„å‚æ•°è¯´æ˜ï¼Œkey å’Œ cert åˆ†åˆ«å¯¹åº”ç€å®‰å…¨ç§˜é’¥å’Œè¯ä¹¦æ–‡ä»¶ï¼š

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/16ace4aaed704d298dcb48de6660cc2f~tplv-k3u1fbpfcp-zoom-1.image)

## ç”Ÿæˆè‡ªç­¾åè¯ä¹¦æ–‡ä»¶ï¼š

&ensp;&ensp;&ensp;&ensp; ç”Ÿæˆè¯ä¹¦çš„ä¸»è¦å·¥å…·æ˜¯ä½¿ç”¨ä½¿ç”¨ **OpenSSL** æ¥æ“ä½œä¸€å †å‘½ä»¤ç”Ÿæˆï¼Œæˆ‘ä»¬è¿™é‡Œæ¨èä¸€ä¸ªéå¸¸ç®€å•çš„ç”Ÿæˆè¯ä¹¦çš„æ–¹å¼ï¼Œå°±æ˜¯ä¸‹å›¾ä¸­æ’åç¬¬ä¸€çš„è¿™ä¸ªå¼€æºé¡¹ç›®ï¼š

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2d172da24ac744caa8d6c1b1488a27ac~tplv-k3u1fbpfcp-zoom-1.image)

### åœ¨ Mac ä¸­ä½¿ç”¨ mkcertï¼š

1.  é€šè¿‡ **brew** å®‰è£… **mkcert**ï¼š

```
brew install mkcert
```

æ³¨ï¼šåœ¨ **linux** ä¸­å¯ä»¥ä½¿ç”¨ **apt**ã€**yum**ç­‰å®‰è£…ï¼Œåœ¨ **windows** ä¸­å¯ä»¥æ”¯æŒä¸‹è½½ **exe** æ–‡ä»¶å¹¶æ‹–æ‹½åˆ°ç»ˆç«¯åæ‰§è¡Œå¯¹åº”çš„å‘½ä»¤ã€‚

2.  ä½¿ç”¨ **-install** å‘½ä»¤å®‰è£…è¯ä¹¦åˆ°ç³»ç»Ÿä¸­ï¼Œä¹Ÿå¯ä»¥é€šè¿‡**-uninstall** æ¥ç§»é™¤è¿™ä¸ªè¯ä¹¦ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ mkcert åå¢åŠ ä¸åŒçš„ location æ¥ç”Ÿæˆç§˜é’¥å’Œè¯ä¹¦æ–‡ä»¶ï¼š

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6bbebdd390294f328d732633be52ab8f~tplv-k3u1fbpfcp-zoom-1.image)

### ç”Ÿæˆè¯ä¹¦å’Œç§˜é’¥æ–‡ä»¶ï¼š

1.  åœ¨é¡¹ç›®ç›®å½•ä¸‹æ–°å»ºå¹¶è¿›å…¥ keys ç›®å½•ï¼š`mkdir keys && cd keys`ï¼›
1.  æ‰§è¡Œç”Ÿæˆå‘½ä»¤ï¼š`mkcert localhost 127.0.0.1`ï¼›
1.  ä¸‹å›¾æç¤ºæˆ‘ä»¬ç”ŸæˆæˆåŠŸäº†ï¼Œè¯ä¹¦æ–‡ä»¶ `localhost+1.pem` å’Œç§˜é’¥æ–‡ä»¶ `localhost+1-key.pem`ï¼›

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d03718aaab884e56ab8b76691f07cfae~tplv-k3u1fbpfcp-zoom-1.image)

## åœ¨ Vite ä¸­é…ç½®è¯ä¹¦æ–‡ä»¶ï¼š

#### è°ƒæ•´è¯ä¹¦å’Œç§˜é’¥æ–‡ä»¶åï¼š

&ensp;&ensp;&ensp;&ensp; æˆ‘ä»¬å°†ç”Ÿæˆåˆ° keys æ–‡ä»¶å¤¹ä¸­çš„ç§˜é’¥å’Œè¯ä¹¦æ–‡ä»¶ä¿®æ”¹æˆNodeJs æ–‡æ¡£ä¸­`  https.createServer `ç¤ºä¾‹çš„æ–‡ä»¶åç§°ï¼š

1.  localhost+1.pem **=>** agent2-cert.pemï¼›
1.  localhost+1-key.pem => agent2-key.pemï¼›

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/949af89546c24b34976955ce6007c7d8~tplv-k3u1fbpfcp-zoom-1.image)

### å®‰è£…è¯ä¹¦ï¼š

åœ¨ç»ˆç«¯æ‰§è¡Œ `mkcert -install`ï¼Œè¾“å…¥å¯†ç éªŒè¯ï¼ŒæˆåŠŸåå¾—åˆ°å¦‚ä¸‹æç¤ºï¼š

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7699f0048ea24146b1c14e83b2c685c5~tplv-k3u1fbpfcp-zoom-1.image)

### è°ƒæ•´ Vite é…ç½®æ–‡ä»¶ï¼š

ä½¿ç”¨ fs æ¨¡å—åˆ†åˆ«è¯»å–è¯ä¹¦å’Œç§˜é’¥æ–‡ä»¶ï¼Œå¹¶é…ç½®åˆ° https å±æ€§ï¼š

```
export default defineConfig({
  plugins: [vue()],
  server: {
    https: {
      key: fs.readFileSync('keys/agent2-key.pem'),
      cert: fs.readFileSync('keys/agent2-cert.pem')
    },
  },
});
```

&ensp;&ensp;&ensp;&ensp; å†æ¬¡å¯åŠ¨æœåŠ¡æµè§ˆå™¨çš„é¡µé¢åˆ·æ–°åå°†ä¸€åˆ‡æ­£å¸¸è®¿é—®äº†ï¼Œå¹¶ä¸”åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹è¯ä¹¦ä¹Ÿæ˜¯æ­£å¸¸çš„äº†ï¼š

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2d8e5334be46453dbbab76f4ff8551cc~tplv-k3u1fbpfcp-zoom-1.image)

## ç»“è¯­ï¼š

&ensp;&ensp;&ensp;&ensp; åœ¨æœ¬åœ°å¼€å‘æˆ–è°ƒè¯•çš„æ—¶å€™æˆ–å¤šæˆ–å°‘ä¼šä½¿ç”¨åˆ° **HTTPS** åè®®ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ç®€å•æ–¹ä¾¿çš„å¼€æº **mkcert** å®Œæˆäº†è¯ä¹¦çš„ç”Ÿæˆï¼Œé€šè¿‡æŸ¥çœ‹ **vite** æ–‡æ¡£æˆåŠŸå¯ç”¨äº† **https**ï¼Œæ¥ä¸‹æ¥å°±æ„‰å¿«çš„ç¼–ç å§ã€‚

* * *

**å¦‚æœçœ‹å®Œè§‰å¾—æœ‰æ”¶è·ï¼Œæ¬¢è¿ç‚¹èµã€è¯„è®ºã€åˆ†äº«æ”¯æŒä¸€ä¸‹ã€‚ä½ çš„æ”¯æŒå’Œè‚¯å®šï¼Œæ˜¯æˆ‘åšæŒå†™ä½œçš„åŠ¨åŠ›~**

æœ€åå¯ä»¥å…³æ³¨æˆ‘@å°é‘«åŒå­¦ã€‚æ¬¢è¿[ç‚¹æ­¤æ‰«ç åŠ æˆ‘å¾®ä¿¡](https://it200.cn/ "https://it200.cn/")[fe-xiaoxin](https://it200.cn/ "https://it200.cn/")äº¤æµï¼Œå…±åŒè¿›æ­¥ï¼ˆè¿˜å¯ä»¥å¸®ä½ **fix**ğŸ›ï¼‰~