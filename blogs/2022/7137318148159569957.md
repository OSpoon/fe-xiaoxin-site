---
title: Babel æ’ä»¶å¼€å‘&è®¿é—®èŠ‚ç‚¹
date: '2022-08-29 23:20'
sidebar: 'auto'
categories:
 - Babel
tags:
 - Babel
---

:::tip
æ•´ç†ä¸€ä¸‹ Babel æ’ä»¶å¼€å‘æ—¶ç”¨å¾—åˆ°çš„è½¬æ¢æ“ä½œç›¸å…³çš„ API~
:::

<!-- more -->

## 1. å‰è¨€
------
å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯[å°é‘«åŒå­¦](https://juejin.cn/user/3966693685871694 "https://juejin.cn/user/3966693685871694")ã€‚ä¸€ä½ä»äº‹è¿‡**Androidå¼€å‘**ã€**æ··åˆå¼€å‘**ï¼Œç°åœ¨é•¿æœŸä»äº‹**å‰ç«¯å¼€å‘**çš„ç¼–ç¨‹çˆ±å¥½è€…ï¼Œ**æˆ‘è§‰å¾—åœ¨ç¼–ç¨‹ä¹‹è·¯ä¸Šæœ€é‡è¦çš„æ˜¯çŸ¥è¯†çš„åˆ†äº«ï¼Œæ‰€è°“ä¸‰äººè¡Œå¿…æœ‰æˆ‘å¸ˆ**ã€‚æ‰€ä»¥æˆ‘å¼€å§‹åœ¨ç¤¾åŒºæŒç»­è¾“å‡ºæˆ‘æ‰€äº†è§£åˆ°ã€å­¦ä¹ åˆ°ã€å·¥ä½œä¸­é‡åˆ°çš„å„ç§ç¼–ç¨‹çŸ¥è¯†ï¼Œæ¬¢è¿æœ‰æƒ³æ³•ã€æœ‰åŒæ„Ÿçš„ä¼™ä¼´åŠ æˆ‘[fe-xiaoxin](https://juejin.cn/pin/7126196941574111262 "https://juejin.cn/pin/7126196941574111262")å¾®ä¿¡äº¤æµ~

æ•´ç†ä¸€ä¸‹ Babel æ’ä»¶å¼€å‘æ—¶ç”¨å¾—åˆ°çš„è½¬æ¢æ“ä½œç›¸å…³çš„ API~

## 2. è®¿é—®èŠ‚ç‚¹
--------

### 2.1 è·å–å­èŠ‚ç‚¹çš„Pathï¼š

æˆ‘ä»¬åœ¨å¤„ç†èŠ‚ç‚¹çš„å±æ€§ä¹‹å‰å¿…é¡»è¦æ‹¿åˆ°èŠ‚ç‚¹å¯¹è±¡æ‰èƒ½è¿›è¡Œæ“ä½œï¼Œæˆ‘ä»¬ä½¿ç”¨`path.node.property`æ¥è®¿é—®å±æ€§~

```JavaScript
BinaryExpression(path) {
  path.node.left;
  path.node.right;
  path.node.operator;
}

```

æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ path å†…ç½®çš„ get å‡½æ•°æ¥æŒ‡å®šå±æ€§åè·å–å±æ€§å€¼~

```JavaScript
BinaryExpression(path) {
  path.get('left');
}
Program(path) {
  path.get('body.0');
}

```

### 2.2 æ£€æŸ¥èŠ‚ç‚¹çš„ç±»å‹ï¼š

æ£€æŸ¥èŠ‚ç‚¹çš„ç±»å‹æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å†…ç½®çš„å·¥å…·ç±»å‡½æ•°`isXxx()`~

```JavaScript
BinaryExpression(path) {
  if (t.isIdentifier(path.node.left)) {
    // ...
  }
}

```

æˆ‘ä»¬åœ¨æ£€æŸ¥ç±»å‹çš„æ—¶å€™è¿˜å¯ä»¥é¡ºä¾¿æ£€æŸ¥å…¶ä¸­çš„æŸäº›å±æ€§æ˜¯å¦è¾¾åˆ°é¢„æœŸ~

```JavaScript
BinaryExpression(path) {
  if (t.isIdentifier(path.node.left, { name: "n" })) {
    // ...
  }
}

// ç®€åŒ–å‰çš„ä»£ç 
BinaryExpression(path) {
  if (
    path.node.left != null &&
    path.node.left.type === "Identifier" &&
    path.node.left.name === "n"
  ) {
    // ...
  }
}

```

### 2.3 æ£€æŸ¥è·¯å¾„ï¼ˆPathï¼‰ç±»å‹ï¼š

è·¯å¾„å…·æœ‰ç›¸åŒçš„æ–¹æ³•æ£€æŸ¥èŠ‚ç‚¹çš„ç±»å‹~

```JavaScript
BinaryExpression(path) {
  if (path.get('left').isIdentifier({ name: "n" })) {
    // ...
  }
}

// ç­‰ä»·äº
BinaryExpression(path) {
  if (t.isIdentifier(path.node.left, { name: "n" })) {
    // ...
  }
}

```

### 2.4 æ£€æŸ¥æ ‡è¯†ç¬¦ï¼ˆIdentifierï¼‰æ˜¯å¦è¢«å¼•ç”¨ï¼š

```JavaScript
Identifier(path) {
  if (path.isReferencedIdentifier()) {
    // ...
  }
}

// æˆ–è€…

Identifier(path) {
  if (t.isReferenced(path.node, path.parent)) {
    // ...
  }
}

```

### 2.5 æ‰¾åˆ°ç‰¹å®šçš„çˆ¶è·¯å¾„ï¼š

å‘ä¸ŠæŸ¥æ‰¾ç‰¹å®šèŠ‚ç‚¹å¯ä»¥ä½¿ç”¨~

```JavaScript
path.findParent((path) => path.isObjectExpression());

```

å¦‚æœä¹Ÿéœ€è¦éå†å½“å‰èŠ‚ç‚¹~

```JavaScript
path.find((path) => path.isObjectExpression());

```

æŸ¥æ‰¾æœ€æ¥è¿‘çš„çˆ¶å‡½æ•°æˆ–ç¨‹åº~

```JavaScript
path.getFunctionParent();

```

å‘ä¸Šéå†è¯­æ³•æ ‘ï¼Œç›´åˆ°æ‰¾åˆ°åœ¨åˆ—è¡¨ä¸­çš„çˆ¶èŠ‚ç‚¹è·¯å¾„~

```JavaScript
path.getStatementParent();

```

### 2.6 è·å–åŒçº§è·¯å¾„ï¼š

å¦‚æœä¸€ä¸ªè·¯å¾„æ˜¯åœ¨ä¸€ä¸ª `Function`ï¼`Program`ä¸­çš„åˆ—è¡¨é‡Œé¢ï¼Œå®ƒå°±æœ‰åŒçº§èŠ‚ç‚¹ã€‚

*   ä½¿ç”¨`path.inList`æ¥åˆ¤æ–­è·¯å¾„æ˜¯å¦æœ‰åŒçº§èŠ‚ç‚¹ï¼Œ
*   ä½¿ç”¨`path.getSibling(index)`æ¥è·å¾—åŒçº§è·¯å¾„,
*   ä½¿ç”¨ `path.key`è·å–è·¯å¾„æ‰€åœ¨å®¹å™¨çš„ç´¢å¼•,
*   ä½¿ç”¨ `path.container`è·å–è·¯å¾„çš„å®¹å™¨ï¼ˆåŒ…å«æ‰€æœ‰åŒçº§èŠ‚ç‚¹çš„æ•°ç»„ï¼‰
*   ä½¿ç”¨ `path.listKey`è·å–å®¹å™¨çš„key

è¿™äº›APIç”¨äº babel-minify ä¸­ä½¿ç”¨çš„ transform-merge-sibling-variables æ’ä»¶.

```JavaScript
var a = 1; // pathA, path.key = 0
var b = 2; // pathB, path.key = 1
var c = 3; // pathC, path.key = 2

```
```JavaScript
export default function({ types: t }) {
  return {
    visitor: {
      VariableDeclaration(path) {
        // if the current path is pathA
        path.inList // true
        path.listKey // "body"
        path.key // 0
        path.getSibling(0) // pathA
        path.getSibling(path.key + 1) // pathB
        path.container // [pathA, pathB, pathC]
      }
    }
  };
}

```

### 2.7 åœæ­¢éå†ï¼š

å½“æˆ‘ä»¬éå†å®Œæˆç›®çš„ååº”è¯¥å°½æ—©ç»“æŸè€Œä¸æ˜¯ç»§ç»­éå†ä¸‹å»~

```JavaScript
BinaryExpression(path) {
  if (path.node.operator !== '**') return;
}

```

å¦‚æœæ‚¨åœ¨é¡¶çº§è·¯å¾„ä¸­è¿›è¡Œå­éå†ï¼Œåˆ™å¯ä»¥ä½¿ç”¨2ä¸ªæä¾›çš„APIæ–¹æ³•~

`path.skip()`è·³è¿‡éå†å½“å‰è·¯å¾„çš„å­è·¯å¾„~

`path.stop()`å®Œå…¨åœæ­¢éå†~

```JavaScript
outerPath.traverse({
  Function(innerPath) {
    innerPath.skip(); // if checking the children is irrelevant
  },
  ReferencedIdentifier(innerPath, state) {
    state.iife = true;
    innerPath.stop(); // if you want to save some state and then stop traversal, or deopt
  }
});

```

* * *

**å¦‚æœçœ‹å®Œè§‰å¾—æœ‰æ”¶è·ï¼Œæ¬¢è¿ç‚¹èµã€è¯„è®ºã€åˆ†äº«æ”¯æŒä¸€ä¸‹ã€‚ä½ çš„æ”¯æŒå’Œè‚¯å®šï¼Œæ˜¯æˆ‘åšæŒå†™ä½œçš„åŠ¨åŠ›~**

æœ€åå¯ä»¥å…³æ³¨æˆ‘@å°é‘«åŒå­¦ã€‚æ¬¢è¿[ç‚¹æ­¤æ‰«ç åŠ æˆ‘å¾®ä¿¡](https://juejin.cn/pin/7126196941574111262 "https://juejin.cn/pin/7126196941574111262")[fe-xiaoxin](https://juejin.cn/pin/7126196941574111262 "https://juejin.cn/pin/7126196941574111262")äº¤æµï¼Œå…±åŒè¿›æ­¥ï¼ˆè¿˜å¯ä»¥å¸®ä½ **fix**ğŸ›ï¼‰~